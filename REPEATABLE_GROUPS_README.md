# ميزة المجموعات المتكررة (Repeatable Groups)

## نظرة عامة

تم إضافة ميزة المجموعات المتكررة إلى نظام طلب الخدمات، مما يسمح للمستخدمين بإضافة عدة مجموعات من الحقول المخصصة حسب الحاجة.

## الميزات

### 1. إضافة مجموعات متكررة
- يمكن للمستخدمين إضافة مجموعات إضافية من الحقول
- كل مجموعة تحتوي على نفس الحقول المخصصة
- يتم ترقيم المجموعات تلقائياً (1، 2، 3، إلخ)

### 2. حذف المجموعات
- يمكن حذف المجموعات الإضافية
- لا يمكن حذف المجموعة الأولى (الأصلية)
- يتم إعادة ترقيم المجموعات تلقائياً

### 3. تصميم متجاوب
- تصميم جميل ومتجاوب
- تأثيرات بصرية عند التفاعل
- تمييز المجموعة الأولى بلون مختلف

## كيفية الاستخدام

### للمطورين

#### 1. تفعيل المجموعة المتكررة
```php
// في قاعدة البيانات، قم بتحديث الحقل ليكون قابلاً للتكرار
$field->update(['is_repeatable' => true]);
```

#### 2. في النموذج (Blade)
```blade
@if($field->is_repeatable)
    <div class="group-controls">
        <button type="button" class="btn btn-sm btn-success add-group-instance">
            <i class="fas fa-plus"></i> إضافة مجموعة
        </button>
        <button type="button" class="btn btn-sm btn-danger remove-group-instance">
            <i class="fas fa-trash"></i> حذف المجموعة
        </button>
    </div>
@endif
```

#### 3. في الكنترولر
```php
// معالجة البيانات المتكررة
$customFields = $request->custom_fields ?? [];
$processedFields = [];

foreach ($customFields as $fieldName => $fieldValues) {
    if (is_array($fieldValues)) {
        // إذا كانت القيم مصفوفة (متكررة)، احفظها كما هي
        $processedFields[$fieldName] = array_filter($fieldValues, function($value) {
            return $value !== null && $value !== '';
        });
    } else {
        // إذا كانت قيمة واحدة، احفظها في مصفوفة
        $processedFields[$fieldName] = [$fieldValues];
    }
}
```

### للمستخدمين

#### 1. إضافة مجموعة جديدة
- انقر على زر "إضافة مجموعة" في أعلى المجموعة
- ستظهر مجموعة جديدة مع نفس الحقول
- املأ الحقول المطلوبة

#### 2. حذف مجموعة
- انقر على زر "حذف المجموعة" في المجموعة المراد حذفها
- لا يمكن حذف المجموعة الأولى

#### 3. ملء البيانات
- كل مجموعة تحتوي على نفس الحقول
- يمكن ملء البيانات بشكل مختلف في كل مجموعة
- الحقول المطلوبة يجب ملؤها في كل مجموعة

## البنية التقنية

### 1. قاعدة البيانات
```sql
-- حقل is_repeatable في جدول category_fields
ALTER TABLE category_fields ADD COLUMN is_repeatable BOOLEAN DEFAULT FALSE;
```

### 2. JavaScript
- `addGroupInstance()`: إضافة مجموعة جديدة
- `removeGroupInstance()`: حذف مجموعة
- تحديث أسماء الحقول والـ IDs تلقائياً
- إعادة ترقيم المجموعات

### 3. CSS
- تصميم متجاوب
- تأثيرات بصرية
- تمييز المجموعة الأولى
- ألوان مختلفة للمجموعات

## أمثلة على الاستخدام

### مثال 1: معلومات الاتصال المتعددة
```
مجموعة 1: اتصال رئيسي
- الاسم: أحمد محمد
- الهاتف: 0501234567
- البريد الإلكتروني: ahmed@example.com

مجموعة 2: اتصال بديل
- الاسم: فاطمة أحمد
- الهاتف: 0509876543
- البريد الإلكتروني: fatima@example.com
```

### مثال 2: عناوين متعددة
```
مجموعة 1: العنوان الرئيسي
- المدينة: الرياض
- الحي: النخيل
- الشارع: شارع الملك فهد

مجموعة 2: عنوان بديل
- المدينة: جدة
- الحي: الكورنيش
- الشارع: شارع التحلية
```

## الملفات المحدثة

1. `resources/views/services/request.blade.php` - نموذج طلب الخدمة
2. `resources/views/services/show.blade.php` - صفحة عرض الخدمة
3. `app/Http/Controllers/ServiceController.php` - كنترولر الخدمات
4. `app/Models/CategoryField.php` - نموذج حقول القسم

## ملاحظات مهمة

1. **الحقول المطلوبة**: يجب ملء الحقول المطلوبة في كل مجموعة
2. **التحقق من البيانات**: يتم التحقق من صحة البيانات قبل الحفظ
3. **الأداء**: تم تحسين الكود للأداء الجيد
4. **التوافق**: متوافق مع جميع المتصفحات الحديثة

## استكشاف الأخطاء

### مشكلة: لا تظهر أزرار إضافة/حذف
- تأكد من أن الحقل marked كـ `is_repeatable = true`
- تحقق من وجود JavaScript في الصفحة

### مشكلة: لا يتم حفظ البيانات المتكررة
- تأكد من تحديث الكنترولر لمعالجة المصفوفات
- تحقق من بنية البيانات المرسلة

### مشكلة: لا يتم عرض البيانات المتكررة
- تأكد من تحديث صفحة العرض
- تحقق من بنية البيانات المحفوظة

## التطوير المستقبلي

1. **حد أقصى للمجموعات**: إضافة خيار لتحديد الحد الأقصى
2. **ترتيب المجموعات**: إمكانية تغيير ترتيب المجموعات
3. **نسخ المجموعات**: نسخ بيانات مجموعة إلى مجموعة جديدة
4. **تصدير/استيراد**: تصدير واستيراد بيانات المجموعات
