# ميزة تسجيل الصوت (Voice Note)

## نظرة عامة
تم إضافة ميزة تسجيل الصوت إلى النظام، مما يسمح للمستخدمين بتسجيل رسائل صوتية عند طلب الخدمات. هذه الميزة متاحة في جميع الأقسام ويمكن تفعيلها أو تعطيلها لكل قسم على حدة.

## الميزات

### 1. تسجيل الصوت
- **تسجيل مباشر**: تسجيل صوتي مباشر من الميكروفون
- **مؤشر بصري**: عرض مؤشر نبض أثناء التسجيل
- **عداد الوقت**: عرض مدة التسجيل
- **محلل الصوت**: عرض موجات الصوت أثناء التسجيل

### 2. التحكم في التسجيل
- **بدء/إيقاف**: أزرار للتحكم في التسجيل
- **تشغيل**: إمكانية تشغيل التسجيل المسجل
- **حذف**: إمكانية حذف التسجيل وإعادة التسجيل

### 3. إدارة الأقسام
- **تفعيل/تعطيل**: إمكانية تفعيل أو تعطيل الميزة لكل قسم
- **تحكم إداري**: إدارة الميزة من لوحة الإدارة

## الملفات المضافة/المعدلة

### 1. قاعدة البيانات
- **Migration**: `2025_08_30_115309_add_voice_note_to_services_table.php`
  - إضافة حقل `voice_note` إلى جدول `services`
- **Migration**: `2025_08_30_115536_add_voice_note_enabled_to_categories_table.php`
  - إضافة حقل `voice_note_enabled` إلى جدول `categories`

### 2. النماذج (Models)
- **Service.php**: إضافة `voice_note` إلى `$fillable`
- **Category.php**: إضافة `voice_note_enabled` إلى `$fillable` و `$casts`

### 3. المتحكمات (Controllers)
- **ServiceController.php**: معالجة حفظ تسجيل الصوت
- **CategoryController.php**: إدارة تفعيل/تعطيل الميزة

### 4. الواجهات (Views)
- **`partials/voice-note-recorder.blade.php`**: واجهة تسجيل الصوت
- **`partials/voice-note-display.blade.php`**: عرض تسجيل الصوت
- **`services/request.blade.php`**: إضافة مسجل الصوت لنموذج الطلب
- **`services/show.blade.php`**: عرض تسجيل الصوت في صفحة الخدمة
- **`services/index.blade.php`**: إشارة لتوفر تسجيل صوتي
- **`admin/categories/edit.blade.php`**: خيار تفعيل/تعطيل الميزة
- **`admin/categories/create.blade.php`**: خيار تفعيل/تعطيل الميزة
- **`admin/categories/index.blade.php`**: عرض حالة الميزة

## كيفية الاستخدام

### للمستخدمين
1. **طلب خدمة**: عند طلب خدمة من قسم مفعل، سيظهر مسجل الصوت
2. **التسجيل**: اضغط على زر "بدء التسجيل" وابدأ بالتحدث
3. **الإيقاف**: اضغط على زر "إيقاف التسجيل" عند الانتهاء
4. **المراجعة**: يمكنك تشغيل التسجيل للاستماع إليه
5. **الحذف**: يمكنك حذف التسجيل وإعادة التسجيل إذا لزم الأمر

### للمديرين
1. **تفعيل الميزة**: في لوحة الإدارة، اذهب إلى إدارة الأقسام
2. **تعديل القسم**: اختر القسم المراد تعديله
3. **تفعيل تسجيل الصوت**: حدد خيار "تفعيل تسجيل الصوت"
4. **حفظ التغييرات**: احفظ التعديلات

## المتطلبات التقنية

### المتصفحات المدعومة
- Chrome 47+
- Firefox 44+
- Safari 11+
- Edge 12+

### API المستخدمة
- **MediaRecorder API**: لتسجيل الصوت
- **Web Audio API**: لتحليل الصوت وعرض الموجات
- **FileReader API**: لتحويل الصوت إلى base64

### التنسيقات المدعومة
- **التسجيل**: WAV format
- **التخزين**: Base64 encoded string
- **التشغيل**: HTML5 Audio element

## الأمان والخصوصية

### حماية البيانات
- يتم تحويل الصوت إلى base64 قبل التخزين
- لا يتم حفظ ملفات صوتية منفصلة
- البيانات محمية بنفس آليات حماية النظام

### أذونات المتصفح
- يتطلب إذن الوصول للميكروفون
- يتم طلب الإذن عند أول استخدام
- يمكن للمستخدم رفض الإذن

## استكشاف الأخطاء

### مشاكل شائعة
1. **لا يمكن الوصول للميكروفون**
   - تأكد من السماح بالوصول للميكروفون في المتصفح
   - تحقق من إعدادات الميكروفون في النظام

2. **لا يعمل التسجيل**
   - تأكد من استخدام متصفح مدعوم
   - تحقق من اتصال الإنترنت

3. **لا يمكن تشغيل التسجيل**
   - تأكد من حفظ التسجيل بشكل صحيح
   - تحقق من تنسيق الصوت

### رسائل الخطأ
- "لا يمكن الوصول للميكروفون": مشكلة في الأذونات
- "متصفحك لا يدعم تشغيل الصوت": متصفح قديم غير مدعوم

## التطوير المستقبلي

### ميزات مقترحة
1. **تحويل الصوت إلى نص**: استخدام Speech-to-Text API
2. **ضغط الصوت**: تقليل حجم البيانات
3. **تسجيل متعدد**: إمكانية تسجيل عدة رسائل
4. **مشاركة التسجيلات**: إرسال التسجيلات عبر البريد الإلكتروني

### تحسينات تقنية
1. **WebRTC**: استخدام تقنيات أحدث للتسجيل
2. **Streaming**: بث الصوت مباشرة
3. **Cloud Storage**: تخزين الصوت في السحابة

## الدعم والمساعدة

للمساعدة في استخدام ميزة تسجيل الصوت:
1. راجع هذا الدليل
2. تحقق من إعدادات المتصفح
3. اتصل بالدعم الفني إذا استمرت المشكلة

---

**ملاحظة**: هذه الميزة تتطلب اتصال إنترنت مستقر وأذونات مناسبة من المتصفح.
